sources:
  kafka_source:
    type: kafka
    bootstrap_servers: "kafka1:9092,kafka2:9092,kafka3:9092"
    topics: ["analytic_events_security"]
    group_id: "vector_clickhouse"

transforms:
  add_timestamp:
    type: remap
    inputs:
      - kafka_source
    source: |
      . = parse_json!(.message)
      .DateTime_vector = to_int!(format_timestamp!(now(), format: "%s"))
      # .event_timestamp = format_timestamp!(parse_timestamp!(.event_timestamp, format: "%Y-%m-%dT%H:%M:%S.%f"),format: "%Y-%m-%dT%H:%M:%S")
      .event_timestamp = parse_timestamp!(.event_timestamp,format: "%Y-%m-%d %H:%M:%S")

sinks:
  clickhouse_sink:
    type: clickhouse
    inputs:
      - add_timestamp
    endpoint: "http://clickhouse-cluster:8123"
    database: "logs"
    table: "analytic_events_security_buffer"
    auth:
      strategy: "basic"
      password: "secret123"
      user: "default"
    encoding:
      timestamp_format: "unix"
    skip_unknown_fields: true
    healthcheck:
      enabled: false
